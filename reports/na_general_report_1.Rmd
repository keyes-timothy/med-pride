---
title: "Needs Assessment Report" 
author: "Timothy Keyes" 
date: "`r Sys.Date()`"
output: 
  github_document:
    toc: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, dpi = 250)
```

```{r message=FALSE, warning=FALSE}
# Libraries
library(tidyverse)
library(lubridate)
library(waffle)

# Parameters
input_path <- here::here("data", "mspa_na_data.rds")
metadata_path <- here::here("data-raw", "school_metadata.csv")

total_md <- 153
total_do <- 36

likert_colors <- c("darkgreen","green","orange","red","darkred")

likert_labels <- 
  c(
    "Strongly disagree",
    "Somewhat disagree", 
    "Neither agree nor disagree", 
    "Somewhat agree", 
    "Strongly agree"
  )

my_theme <- 
  theme(
    axis.text.y = element_text(size = 9),
    axis.text.x = element_text(size = 9, angle = 45, hjust = 1),
    axis.title.y = element_text(size = 12, face = "bold"), 
    axis.title.x = element_text(size = 12, face = "bold")
  ) 

mspa_hex <- "#666699"

#===============================================================================

# read in data
na_data <- 
  input_path %>% 
  read_rds()

metadata <- 
  metadata_path %>% 
  read_csv() %>% 
  drop_na()
```

## Broad data and recruitment summary

First, we want to see if we were able to obtain consent from everyone who took the survey: 

```{r}
na_data %>% 
  count(consent)
```

Thus, we can see that there are 32 people who didn't actually check the "consent" box. They will need to be removed from the analysis. 

We can also look, for our own purposes, of the number of responses over the time window that the survey was open. 

```{r}
na_data %>% 
  count(date = lubridate::as_date(timestamp), name = "responses") %>% 
  ggplot(aes(x = date, y = responses)) + 
  geom_line() + 
  scale_x_date(
    breaks = scales::breaks_width(width = "2 months"), 
    labels = scales::label_date(format = "%b %Y")
  ) + 
  labs(
    title = "Number of responses to the N-A survey by date", 
    x = NULL, 
    y = "Responses (# of students per day)"
  )

```

From this, we can see that recruitment tends to happen in a punctuated fashion rather than by trickle-in over time. Each of the peaks corresponds to pushes coordinated by our team to send the survey to additional schools.

For a cumulative plot...

```{r, warning = FALSE}
num_students <- function(date) { 
  na_data %>% 
    mutate(my_date = as_date(timestamp)) %>% 
    filter(my_date <= date) %>% 
    count() %>% 
    pull(n)
}

na_data %>% 
  transmute(
    my_date = as_date(timestamp), 
    unique_students = 
      map_int(my_date, num_students)
  ) %>% 
  ggplot(aes(x = my_date, y = unique_students)) + 
  geom_line() + 
  scale_x_date(
    breaks = scales::breaks_width(width = "2 months"), 
    labels = scales::label_date(format = "%b %Y")
  ) + 
  labs(
    title = "Respondent recruitment over time", 
    x = NULL, 
    y = "Number of unique students"
  )

```


We can also look at our recruitment of unique schools over time: 

```{r, warning=FALSE}
num_schools <- function(date) { 
  na_data %>% 
    mutate(my_date = as_date(timestamp)) %>% 
    filter(my_date <= date) %>% 
    pull(school_attend) %>% 
    n_distinct()
}


na_data %>% 
  transmute(
    my_date = as_date(timestamp), 
    unique_schools = 
      map_int(my_date, num_schools)
  ) %>% 
  ggplot(aes(x = my_date, y = unique_schools)) + 
  geom_line() + 
  scale_x_date(
    breaks = scales::breaks_width(width = "2 months"), 
    labels = scales::label_date(format = "%b %Y")
  ) + 
  labs(
    title = "School recruitment over time", 
    x = NULL, 
    y = "Number of unique schools recruited"
  )

```

Together, these plots indicate that, in general, having a survey link passively open over time does not really lead to the steady "trickling in" of responses over time. Rather, it seems that coordinated pushes of survey instruments to specific schools (with wide desemination) yield the most responses, Thus, one strategic recommendation for MSPA might be to build its survey instrument distribution infrastructure (either through a portal, an app that MSPA members can have on their phones, or some other architecture that leverages our campus network). 

## Wrangling

I've already done some data cleaning in previous scripts, but there are still a few tweaks that we probably want to make so that everything is human-readable and so that only useful information is carried forward. 

First, we want to remove people who did not consent to the survey, since we can't use their information anyway. 

```{r}
na_data <- 
  na_data %>% 
  filter(consent == "yes")
```

And then we can filter out some variables that we don't need.

```{r}
na_data <- 
  na_data %>% 
  select(-survey_id, -consent, -complete)
```

And create a few variables that we'll need later: 

```{r}
na_data <- 
  na_data %>% 
  mutate(
    sex = 
      case_when(
        sab_is_male == "yes"   ~ "male", 
        sab_is_female == "yes" ~ "female", 
        TRUE                   ~ NA_character_
      )
  ) %>% 
  left_join(metadata, by = c("school_attend" = "name"))
```


## Univariate Demographics report

The first section of the survey asked questions about respondents' demographic identifiers, including the following: 

* What school they attend 
* What year of medical school they're in
* Whether or not they identify as LGBTQ+
* What sex they were assigned at birth 
* What their current gender identity is
* What they current sexual orientation is
* Their race/ethnicity

Below, we report the breakdown of our survey respondents by each of these demographics.

### What school do you attend?

Schools are arranged in order of decreasing number of responses. 

```{r}
na_data %>%
  count(school_attend, name = "Number of responses") %>% 
  mutate(
    `Percentage of total responses` = 
      ((`Number of responses` / sum(`Number of responses`)) * 100) %>% 
      round(digits = 1)
  ) %>% 
  rename(School = school_attend) %>% 
  arrange(desc(`Number of responses`)) %>% 
  knitr::kable()
```

### What year of medical school are you in? 

```{r, fig.width = 6}
n <- 
  na_data %>% 
  filter(!is.na(med_school_year)) %>% 
  count() %>% 
  pull(n)

na_data %>% 
  drop_na(med_school_year) %>% 
  mutate(
    med_school_year = fct_infreq(med_school_year %>% str_wrap(width = 25))
  ) %>% 
  ggplot(aes(x = med_school_year)) + 
  geom_bar(fill = mspa_hex) + 
  my_theme + 
  labs(
    x = NULL, 
    y = "Number of students", 
    caption = str_glue("N = ", {n})
  )
```


### Do you identify as LGBTQ+?

```{r}
n <- 
  na_data %>% 
  drop_na(is_lgbtq) %>% 
  count() %>%
  pull(n)

ns <- 
  na_data %>% 
  drop_na(is_lgbtq) %>% 
  count(is_lgbtq)

n_lgbtq <- ns$n[[1]]
n_n_lgbtq <- ns$n[[2]]

na_data %>% 
  drop_na(is_lgbtq) %>% 
  ggplot(aes(x = is_lgbtq)) + 
  geom_bar(fill = mspa_hex) + 
  labs(
    x = NULL, 
    y = "Number of respondents", 
    caption = str_glue("N = {n}")
  )
```

Or visualized slightly differently...

```{r}
na_data %>% 
  drop_na(is_lgbtq) %>% 
  count(is_lgbtq) %>% 
  ggplot(aes(fill = is_lgbtq, values = n)) + 
  geom_waffle(color = "white", n_rows = 25, size = 0.25, make_proportional = FALSE) + 
  scale_y_discrete(expand = c(0, 0)) +
  scale_x_continuous(
    labels = function(x) x * 25, 
    expand = c(0, 0)
  ) +
  scale_fill_manual(
    name = NULL, 
    labels = 
      c(
        str_glue("LGBTQ+\n({n_lgbtq})"), 
        str_glue("Non-LGBTQ+\n({n_n_lgbtq})")
      ),
    values = c(mspa_hex, "gray60")
  ) +
  coord_equal() +
  theme_minimal() + 
  theme(
    strip.text = element_text(angle = 0, hjust = 0), 
    panel.grid = element_blank(), 
    axis.ticks.x = element_line(), 
    legend.position = "bottom"
  ) + 
  labs(
    subtitle = "Do you identify as LGBTQ+?",
    x = "Number of students"
  )

```


### What is your sex assigned at birth?

```{r}
n <- 
  na_data %>% 
  filter(!is.na(sex)) %>% 
  count() %>% 
  pull(n)

na_data %>% 
  drop_na(sex) %>% 
  ggplot(aes(x = sex)) + 
  geom_bar() + 
  theme(
    axis.text = element_text(size = 12), 
    axis.title = element_text(size = 16)
  ) + 
  labs(
    x = NULL, 
    y = "Number of students", 
    caption = str_glue("N = {n}")
  )
```


Or, visualized slightly differently...
```{r}
ns <- 
  na_data %>% 
  filter(!is.na(sex)) %>% 
  count(sex)

n_male <- ns$n[[2]]
n_female <- ns$n[[1]]

ns %>% 
  ggplot(aes(fill = sex, values = n)) + 
  geom_waffle(color = "white", n_rows = 21, size = 0.25, make_proportional = FALSE) + 
  scale_y_discrete(expand = c(0, 0)) +
  scale_x_continuous(
    labels = function(x) x * 21, 
    expand = c(0, 0)
  ) +
  ggthemes::scale_fill_tableau(
    name = NULL, 
    labels = 
      c(
        str_glue("Female\n({n_female})"), 
        str_glue("Male\n({n_male})")
      ),
    palette = "Tableau 10"
  ) +
  coord_equal() +
  theme_minimal() + 
  theme(
    strip.text = element_text(angle = 0, hjust = 0), 
    panel.grid = element_blank(), 
    axis.ticks.x = element_line(), 
    legend.position = "bottom"
  ) + 
  labs(
    subtitle = "What was your sex assigned at birth?",
    x = "Number of students"
  )

```

### What is your gender identity?

```{r}
n <- 
  na_data %>% 
  filter_at(
    .vars = vars(starts_with("gender_")), 
    .vars_predicate = any_vars(!is.na(.))
  ) %>% 
  count() %>% 
  pull(n)

na_data %>% 
  summarize_at(
    .vars = vars(starts_with("gender")), 
    ~ sum(. == "yes")
  ) %>% 
  select(-gender_another_description) %>% 
  pivot_longer(
    cols = everything(), 
    names_to = "gender", 
    values_to = "Number of respondents", 
    names_prefix = "gender_"
  ) %>% 
  mutate(
    gender = fct_reorder(gender, desc(`Number of respondents`)), 
    percentage = (`Number of respondents` / sum(`Number of respondents`)) * 100
  ) %>% 
  ggplot(aes(x = gender, y = `Number of respondents`)) + 
  geom_col() + 
  geom_text(
    aes(
      y = `Number of respondents` + 15, 
      label = str_c(percentage %>% round(digits = 1), "%")
    )
  ) + 
  labs(
    x = NULL, 
    caption = str_glue("N = {n}")
  )
```

### What is your sexual orientation?

```{r}
n <- 
  na_data %>% 
  filter_at(
    .vars = vars(starts_with("so_")), 
    .vars_predicate = any_vars(!is.na(.))
  ) %>% 
  count() %>% 
  pull(n)

na_data %>% 
  summarize_at(
    .vars = vars(starts_with("so_")), 
    ~ sum(. == "yes")
  ) %>% 
  select(-so_another_description) %>% 
  pivot_longer(
    cols = everything(), 
    names_to = "sexual_orientation", 
    values_to = "Number of respondents", 
    names_prefix = "so_"
  ) %>% 
  mutate(
    sexual_orientation = fct_reorder(sexual_orientation, desc(`Number of respondents`)), 
    percentage = (`Number of respondents` / sum(`Number of respondents`)) * 100
  ) %>% 
  ggplot(aes(x = sexual_orientation, y = `Number of respondents`)) + 
  geom_col() + 
  geom_text(
    aes(
      y = `Number of respondents` + 15, 
      label = str_c(percentage %>% round(digits = 1), "%")
    )
  ) + 
  labs(
    x = NULL, 
    caption = str_glue("N = {n}")
  )
```

### What is your racial/ethnic background?

```{r}
n <- 
  na_data %>% 
  filter_at(
    .vars = vars(starts_with("race_")), 
    .vars_predicate = any_vars(!is.na(.))
  ) %>% 
  count() %>% 
  pull(n)

na_data %>% 
  summarize_at(
    .vars = vars(starts_with("race_")), 
    ~ sum(. == "yes")
  ) %>% 
  select(-race_another_explanation) %>% 
  pivot_longer(
    cols = everything(), 
    names_to = "race", 
    values_to = "Number of respondents", 
    names_prefix = "race_"
  ) %>% 
  mutate(
    race = fct_reorder(race, desc(`Number of respondents`)), 
    percentage = (`Number of respondents` / n) * 100
  ) %>% 
  ggplot(aes(x = race, y = `Number of respondents`)) + 
  geom_col() + 
  geom_text(
    aes(
      y = `Number of respondents` + 15, 
      label = str_c(percentage %>% round(digits = 1), "%")
    )
  ) + 
  scale_x_discrete(
    labels = 
      c("White", "Asian", "Hispanic", 
        "Black", "Another", "Native", 
        "Pacific Islander")
  ) + 
  labs(
    x = NULL, 
    caption = str_glue("N = {n}")
  )
```

So we can see that most of the respondents are white, a group that accounts for about 2/3 of the total responses. There are a smaller percentage of Asian, Hispanic, and Black respondents, with Native, Pacific Islander, and "Other" groups corresponding to around 1% of the responses, each. 

### Program type

With merged data about the school that each student attends, we can also compare the number of MD and the number of DO students who responded to the survey: 

```{r}
n <- 
  na_data %>% 
  filter(!is.na(Degree)) %>% 
  count() %>%
  pull(n)

na_data %>% 
  drop_na(Degree) %>% 
  count(Degree, name = "Number of respondents") %>% 
  mutate(
    Degree = fct_reorder(Degree, desc(`Number of respondents`)), 
    percentage = (`Number of respondents` / sum(`Number of respondents`)) * 100
  ) %>% 
  ggplot(aes(x = Degree, y = `Number of respondents`)) + 
  geom_col() + 
  geom_text(
    aes(
      y = `Number of respondents` + 20, 
      label = str_c(percentage %>% round(digits = 1), "%")
    )
  ) + 
  labs(
    title = "Number of responses from MD- and DO-granting programs", 
    x = NULL, 
    caption = str_glue("N = {n}")
  )
```

Thus, we can see that the number of DO student responses is relatively small relative to the number of MD students.

We can appreciate this sligtly better with a waffle visualization: 

```{r}
ns <- 
  na_data %>% 
  filter(!is.na(Degree)) %>% 
  count(Degree)
n_md <- ns$n[[2]]
n_do <- ns$n[[1]]

na_data %>% 
  drop_na(Degree) %>% 
  count(Degree) %>% 
  ggplot(aes(fill = Degree, values = n)) + 
  geom_waffle(color = "white", n_rows = 21, size = 0.25, make_proportional = FALSE) + 
  scale_y_discrete(expand = c(0, 0)) +
  scale_x_continuous(
    labels = function(x) x * 21, 
    expand = c(0, 0)
  ) +
  ggthemes::scale_fill_tableau(
    name = NULL, 
    labels = 
      c(
        str_glue("DO ({n_do})"), 
        str_glue("MD ({n_md})")
      ),
    palette = "Tableau 10"
  ) +
  coord_equal() +
  theme_minimal() + 
  theme(
    strip.text = element_text(angle = 0, hjust = 0), 
    panel.grid = element_blank(), 
    axis.ticks.x = element_line(), 
    legend.position = "bottom"
  ) + 
  labs(
    subtitle = "What degree does your program confer?",
    x = "Number of students"
  )
  
```


## Number of unique medical schools

According to the Association of American Medical Colleges, there are [153 accredited MD-granting programs in the United States](https://www.aamc.org/data-reports/students-residents/interactive-data/2019-facts-applicants-and-matriculants-data); likewise, the American Association of Colleges of Osteopathic Medicine (AACOM) [accredits 36 DO-granting programs](https://www.aacom.org/become-a-doctor/u-s-colleges-of-osteopathic-medicine) in the United States.

So, we can compute the number of unique MD and unique DO schools (as well as their percentage of the national numbers). 

```{r}
totals <- tibble(Degree = c("DO", "MD"), total = c(total_do, total_md))

na_data %>% 
  select(school_attend, Degree) %>%
  drop_na() %>% 
  distinct() %>%
  count(Degree) %>% 
  left_join(totals, by = "Degree") %>% 
  mutate(proportion = n / total) %>% 
  knitr::kable()

```

So, we can see that we have 100 MD schools (65% of total schools), and 18 DO schools (50% of total).

However, we remember from our response plots above that most of the schools from which we have responses only have a few (<5) students who responded...this is a problem we will either have to solve or something that we will have to wordsmith around. 

## Do medical students think MSPA is a good idea? 

In the second section of the needs-assessment survey, we asked questions about intercollegiate LGBTQ+ affinity group engagement and whether or not students felt that a national LGBTQ+ affinity organization would enhance their school's LGBTQ+ diversity/inclusion climate. 

Here's a generally useful function for plotting likert scale data that we'll use throughout this section: 

```{r}
## description: plots a stacked bar plot between LGBTQ+ and non-LGBTQ+ individuals when the likert scale is 
##              encoded by the variable my_var. Will provide the plot with the title `title` and the caption 
##              N = `n`. 
likert_plot <- function(my_var = NULL, title = NULL, n = NULL) { 
  na_data %>% 
    drop_na({{my_var}}, is_lgbtq) %>% 
    group_by(is_lgbtq, {{my_var}}) %>% 
    summarize(number = n()) %>% 
    mutate(proportion = number / sum(number)) %>% 
    ggplot(
      aes(
        x = is_lgbtq, 
        y = proportion, 
        fill = factor({{my_var}}, levels = as.character(5:1))
      )
    ) + 
    geom_hline(yintercept = 0.5, color = "black") + 
    geom_col() + 
    scale_y_continuous(labels = scales::label_percent(accuracy = 1)) + 
    scale_fill_brewer(
      labels = rev(likert_labels), 
      type = "div",
      palette = "RdYlGn", 
      aesthetics = "fill", 
      direction = -1, 
      guide = guide_legend(reverse = TRUE)
    ) + 
    coord_flip() + 
    theme(
      legend.title = element_text(size = 9),
      aspect.ratio = 0.4, 
      legend.position = "bottom"
    ) +  
    labs(
      subtitle = title,
      x = NULL,
      y = "Percentage of respondents", 
      fill = NULL,
      caption = str_glue("N = {n}")
    )
}
```



### Intercollegiate engagement of LGBTQ+ affinity organizations

**By individual - each person is a point**
```{r, fig.width=8}
#agree
n <- 
  na_data %>% 
  drop_na(interaction_agree, is_lgbtq) %>% 
  count() %>% 
  pull(n)

likert_plot(
  my_var = interaction_agree, 
  title = 
    "\"The LGBTQ+ community at my school interacts with the LGBTQ+ community at other institutions\"",
  n = n
)

#satisfied
n <- 
  na_data %>% 
  drop_na(interaction_satisfaction, is_lgbtq) %>% 
  count() %>% 
  pull(n)

likert_plot(
  my_var = interaction_satisfaction, 
  title = 
    "\"I am satisfied with the degree to which the LGBTQ+ community at my school interacts with the LGBTQ+ community at other institutions\"",
  n = n
)
```

In the above plots, note that we put a black reference line at 50% in order to indicate that the majority of 
LGBTQ-identifying medical students both disagree with the statement that their local LGBTQ+ affinity 
organization interacts with the larger LGBTQ+ community *and* that they are not satisfied with the level of 
intercollegiate interaction that they do have.

**By school - each school is a point**

If we take each unique school and average the likert scale ratings, we can make box-and-whisker plots to summarize the data in a slightly different way. 

```{r, fig.width = 8}
var_labels <- 
  setNames(
    object = , 
      c(
        "\"The LGBTQ+ community at my school interacts with the LGBTQ+ community at other institutions\"" %>% 
          str_wrap(width = 50), 
        "\"I am satisfied with the degree to which the LGBTQ+ community at my school interacts with the LGBTQ+ community at other institutions\"" %>% 
          str_wrap(width = 50)
      ), 
    nm = c("agree", "satisfaction")
  )

na_data %>% 
  drop_na(Degree, is_lgbtq) %>% 
  group_by(school_attend, is_lgbtq) %>% 
  summarize_at(
    vars(starts_with("interaction_")), 
    mean, 
    na.rm = TRUE
  ) %>% 
  pivot_longer(
    cols = starts_with("interaction_"), 
    names_to = "variable", 
    values_to = "value", 
    names_prefix = "interaction_"
  ) %>% 
  ggplot(aes(x = is_lgbtq, y = value, fill = is_lgbtq)) + 
  geom_boxplot(outlier.shape = NA) +
  geom_jitter(width = 0.2, alpha = 0.4, stroke = 0, color = "black") + 
  facet_wrap(vars(variable), labeller = labeller(variable = var_labels)) + 
  scale_y_continuous(minor_breaks = NULL) + 
  labs(
    subtitle = "", 
    x = NULL, 
    y = "Mean likert score across all respondents (1-5)", 
    fill = NULL
  )
  
```


### Perceived benefit from a national LGBTQ+ affinity organization for medical students

**Personal Benefit**

On an individual level...

```{r, fig.width = 8}
n <- 
  na_data %>% 
  drop_na(is_lgbtq, personal_benefit_mspa) %>% 
  count() %>% 
  pull(n)

likert_plot(
  my_var = personal_benefit_mspa, 
  title = "I would personally benefit from a national LGBTQ+ affinity organization", 
  n = n
)
```

So, it's clear that the majority of LGBTQ+-identifying students feel that they would personally benefit from the existence of an organization like MSPA, with nearly 50% strongly agreeing with this statement. By contrast, most non-LGBTQ+ students didn't feel that they would necessarily benefit from such an organization personally. 

**Community benefit:**

On an individual level...

```{r, fig.width = 8}
n <- 
  na_data %>% 
  drop_na(is_lgbtq, community_benefit_mspa) %>% 
  count() %>% 
  pull(n)

likert_plot(
  my_var = community_benefit_mspa, 
  title = 
    "My community would  benefit from a national LGBTQ+ affinity organization", 
  n = n
)
```


Here, we see that over 50% of all LGBTQ+ students feel that the existence of an organization such as MSPA would benefit their overall community (even if it doesn't benefit them personally), with over 80% indicating some degree of agreement. 

In addition, this plot shows us that most non-LGBTQ+ students **also** agree that the existence of an organization like MSPA would benefit the community, even if they themselves won't necessarily benefit from the org's existence personally. 

### Which of your school's activities would be enhanced by a national LGBTQ+ medical student organization?

```{r}
affinity_recode <- 
  c(
    "lgbtq_meded" = "LGBTQ+ health education",
    "social" = "LGBTQ+ social events", 
    "di_training" = "Health care provider diversity/inclusion training",
    "discrim_bias_reduction" = "Discrimination and bias reduction", 
    "mentorship" = "Physician mentorship for LGBTQ+ students",
    "advocacy" = "LGBTQ+ political/social advocacy",
    "global_health" = "LGBTQ+ Global Health",
    "other" = "Other"
  )

n <- 
  na_data %>% 
 filter_at(
    .vars = vars(starts_with("enhanced_activity")), 
    .vars_predicate = any_vars(!is.na(.))
  ) %>% 
  drop_na(is_lgbtq) %>% 
  count() %>% 
  pull(n)
  

na_data %>% 
 filter_at(
    .vars = vars(starts_with("enhanced_activity")), 
    .vars_predicate = any_vars(!is.na(.))
  ) %>% 
  drop_na(is_lgbtq) %>% 
  summarize_at(
    vars(starts_with("enhanced_activity")), 
    ~ sum(. == "yes")
  ) %>% 
  select(-enhanced_activity_mspa_other_explanation) %>% 
  pivot_longer(
    cols = starts_with("enhanced_activity"), 
    names_to = "activity", 
    values_to = "Number of respondents", 
    names_prefix = "enhanced_activity_mspa_"
  ) %>% 
  mutate(
    activity = 
      fct_reorder(activity, desc(`Number of respondents`)) %>% 
      dplyr::recode(!!! affinity_recode),
    percentage = (`Number of respondents` / n) * 100
  ) %>% 
  ggplot(aes(x = activity, y = `Number of respondents`)) + 
  geom_col() + 
  geom_text(
    aes(
      y = `Number of respondents` + 50, 
      label = str_c(percentage %>% round(digits = 1), "%")
    )
  ) +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 30)) + 
  coord_flip() + 
  labs(
    subtitle = "Students feel that a national LGBTQ+ org will most enhance medical\neducation, advocacy, diversity & inclusion training, and LGBTQ+ mentorship", 
    x = NULL, 
    caption = str_glue("N = {n}")
  )
  
```

The plot above shows that the number 1 item that students felt would be enhanced by an organization like MSPA existing would be LGBTQ+ health education and curriculur design. 

But we can also see that 2.3% felt that "other" activities would be enhanced. What were those? 

```{r}
na_data %>% 
  select(enhanced_activity_mspa_other_explanation) %>%
  distinct() %>% 
  knitr::kable()
```

Funnily enough, no one provided any text in the free text box! Oh well. 

Of course, the data about are aggregated - the question still remains: did SGM and non-SGM feel differently about what activities would be enhanced by MSPA? 

```{r}
ns <- 
  na_data %>% 
  filter_at(
    .vars = vars(starts_with("enhanced_activity")), 
    .vars_predicate = any_vars(!is.na(.))
  ) %>% 
  drop_na(is_lgbtq) %>% 
  count(is_lgbtq)
  
na_data %>% 
  filter_at(
    .vars = vars(starts_with("enhanced_activity")), 
    .vars_predicate = any_vars(!is.na(.))
  ) %>% 
  drop_na(is_lgbtq) %>% 
  group_by(is_lgbtq) %>% 
  summarize_at(
    vars(starts_with("enhanced_activity")), 
    ~ sum(. == "yes")
  ) %>% 
  select(-enhanced_activity_mspa_other_explanation) %>% 
  pivot_longer(
    cols = starts_with("enhanced_activity"), 
    names_to = "activity", 
    values_to = "Number of respondents", 
    names_prefix = "enhanced_activity_mspa_"
  ) %>% 
  left_join(ns, by = "is_lgbtq") %>% 
  mutate(
    activity = 
      fct_reorder2(activity, desc(is_lgbtq), desc(`Number of respondents`)) %>% 
      dplyr::recode(!!! affinity_recode),
    percentage = (`Number of respondents` / n) * 100, 
    is_lgbtq = fct_relevel(is_lgbtq, "Non-LGBTQ+", "LGBTQ+")
  ) %>% 
  ggplot(aes(x = activity, y = `Number of respondents`, fill = is_lgbtq)) + 
  geom_col(position = "dodge") + 
  geom_text(
    aes(
      y = `Number of respondents` + 35, 
      label = str_c(percentage %>% round(digits = 1), "%")
    ), 
    position = position_dodge(width = 0.8)
  ) +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 30)) + 
  scale_y_continuous(limits = c(NA, 570)) + 
  scale_fill_manual(values = c("#00BFC4", "#F8766D")) + 
  coord_flip() + 
  labs(
    subtitle = "LGBTQ+ students feel that a national LGBTQ+ org will most enhance medical\neducation, advocacy, mentorship, and social evente", 
    x = NULL, 
    fill = NULL, 
    caption = ""
  )
  
```

These data tell a slightly different story: LGBTQ+ students still think MSPA's greatest strength will be in enhancing LGBTQ+ medical education and political/social advocacy, but they tend to think mentorship and social events will be more enhanced than non-LGBTQ+ students do. 

## Current-state assessment of local LGBTQ+ organizations 

Our needs assessment also included several questions about what students' local affinity organizations were like. The variables we measured included the following: 

* Does your school have a medical student LGBTQ+ organization of some kind? 
* If no, do you think this is something you would benefit from?
* If yes, are you involved in that organization in some way? If not, why not?
* Which of the following student group activies do you engage in?

### Does your school have a medical student LGBTQ+ affinity organization?

```{r}
n <- 
  na_data %>% 
  drop_na(Degree, school_affinity_group_exist) %>% 
  pull(school_attend) %>% 
  n_distinct()

percentage_schools <- 
  na_data %>% 
  drop_na(Degree, school_affinity_group_exist) %>% 
  group_by(school_attend) %>% 
  count(school_affinity_group_exist) %>% 
  filter(n == max(n)) %>% 
  pull(school_affinity_group_exist) %>% 
  `==`("yes") %>% 
  mean() * 
  100
```

Thus, we can see that `r str_c(percentage_schools %>% round(1), "%")` of our `r n` schools have a local affinity LGBTQ+ affinity organization. 

The schools that don't are as follows: 

```{r}
na_data %>% 
  drop_na(Degree, school_affinity_group_exist) %>% 
  group_by(school_attend) %>% 
  count(school_affinity_group_exist) %>% 
  filter(n == max(n)) %>% 
  filter(school_affinity_group_exist == "no") %>% 
  select(school_attend) %>% 
  rename(
    `Medical schools without LGBTQ+ affinity organizations` = school_attend
  ) %>% 
  knitr::kable()
```

So, for the students at these schools, do they think it'd be beneficial to have one? 

```{r, fig.width = 10}
ns <- 
  na_data %>% 
  filter(school_affinity_group_exist == "no") %>% 
  count(is_lgbtq)

na_data %>% 
  filter(school_affinity_group_exist == "no") %>% 
  group_by(is_lgbtq) %>% 
  summarize(
    number = sum(school_affinity_group_benefit == 1, na.rm = TRUE), 
    total = n(),
    prop = number / total
  ) %>% 
  ggplot(aes(x = is_lgbtq, y = prop, fill = is_lgbtq)) + 
  geom_col() + 
  scale_y_continuous(
    breaks = scales::breaks_width(width = 0.2), 
    labels = scales::label_percent(accuracy = 1)
  ) + 
  coord_fixed(2) + 
  theme(legend.position = "none") + 
  labs(
    subtitle = "\"Do you feel that an LGBTQ+ affinity organization is something you would benefit from?\"",
    x = NULL, 
    y = "Percentage of respondents who answered \"yes\"", 
    fill = NULL, 
    caption = 
        expression(
          paste(N["LGBTQ+"], " = ", 26, ";  ", N["non-LGBTQ+"], " = ", 33)
        )
  )

```

So, we can see that over 80% of LGBTQ+ students do feel that it's something they would benefit from, but there's not a ton of strong allyship going on (clearly). 

Shown a different way: 

```{r}
na_data %>% 
  filter(school_affinity_group_exist == "no") %>% 
  group_by(is_lgbtq) %>% 
  summarize(
    yes = sum(school_affinity_group_benefit == 1, na.rm = TRUE), 
    no = sum(school_affinity_group_benefit == 2, na.rm = TRUE),
    dont_know = sum(school_affinity_group_benefit == 3, na.rm = TRUE),
  ) %>% 
  pivot_longer(
    cols = c(yes, no, dont_know), 
    names_to = "response", 
    values_to = "count"
  ) %>% 
  ggplot(aes(fill = response, values = count)) + 
  geom_waffle(color = "white", n_rows = 3, size = 1, make_proportional = FALSE) + 
  facet_wrap(~is_lgbtq, ncol = 1) + 
  scale_y_discrete(expand = c(0, 0)) +
  scale_x_continuous(
    labels = function(x) x * 3, 
    expand = c(0, 0)
  ) +
  ggthemes::scale_fill_tableau(
    name = NULL, 
    breaks = c("yes", "no", "dont_know"), 
    labels = c("Yes", "No", "Don't know")
  ) +
  coord_equal() +
  theme_minimal() + 
  theme(
    strip.text = element_text(angle = 0, hjust = 0), 
    panel.grid = element_blank(), 
    axis.ticks.x = element_line()
  ) + 
  labs(
    subtitle = "\"Do you feel that an LGBTQ+ affinity organization is something you would benefit from?\"",
    x = "Number of students"
  )
```

Visualized this way, we can see that straight people aren't **that** problematic: they just aren't sure if they would be benefitted by their school having an LGBTQ+ affinity organization.

### Student involvement in local LGBTQ+ affinity organizations

For schools that **did** have a local LGBTQ+ affinity organization, we asked 













