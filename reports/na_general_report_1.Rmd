---
title: "Needs Assessment Report" 
author: "Timothy Keyes" 
date: "`r Sys.Date()`"
output: 
  html_document: 
    toc: true
  github_document:
    toc: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE, dpi = 250)
```

```{r message=FALSE, warning=FALSE}
# Libraries
library(tidyverse)
library(lubridate)
library(waffle)

# Parameters
input_path <- here::here("data", "mspa_na_data.rds")
metadata_path <- here::here("data-raw", "school_metadata.csv")

total_md <- 153
total_do <- 36

likert_colors <- c("darkgreen","green","orange","red","darkred")

likert_labels <- 
  c(
    "Strongly disagree",
    "Somewhat disagree", 
    "Neither agree nor disagree", 
    "Somewhat agree", 
    "Strongly agree"
  )

interest_labels <- 
  c(
    "Not at all interested",
    "Less interested", 
    "Undecided", 
    "Somewhat interested", 
    "Very interested"
  )

my_theme <- 
  theme(
    axis.text.y = element_text(size = 9),
    axis.text.x = element_text(size = 9, angle = 45, hjust = 1),
    axis.title.y = element_text(size = 12, face = "bold"), 
    axis.title.x = element_text(size = 12, face = "bold")
  ) 

mspa_hex <- "#666699"

#===============================================================================

# read in data
na_data <- 
  input_path %>% 
  read_rds()

metadata <- 
  metadata_path %>% 
  read_csv() %>% 
  drop_na()
```

## Broad data and recruitment summary

First, we want to see if we were able to obtain consent from everyone who took the survey. 

```{r}
na_data %>% 
  count(consent) %>% 
  knitr::kable()
```

From looking at the consent data field, we can see that there are 32 people who didn't actually check the "consent" box. They will need to be removed from the analysis. 

We can also look, for our own purposes, of the number of responses over the time window that the survey was open. 

```{r}
na_data %>% 
  count(date = lubridate::as_date(timestamp), name = "responses") %>% 
  ggplot(aes(x = date, y = responses)) + 
  geom_line() + 
  scale_x_date(
    breaks = scales::breaks_width(width = "2 months"), 
    labels = scales::label_date(format = "%b %Y")
  ) + 
  labs(
    title = "Number of responses to the NA survey by date", 
    x = NULL, 
    y = "Responses (# of students per day)"
  )

```

From this, we can see that recruitment tends to happen in a punctuated fashion rather than by trickle-in over time. Each of the peaks corresponds to pushes coordinated by our team to send the survey to additional schools.

For a cumulative plot...

```{r, warning = FALSE}
num_students <- function(date) { 
  na_data %>% 
    mutate(my_date = as_date(timestamp)) %>% 
    filter(my_date <= date) %>% 
    count() %>% 
    pull(n)
}

na_data %>% 
  transmute(
    my_date = as_date(timestamp), 
    unique_students = 
      map_int(my_date, num_students)
  ) %>% 
  ggplot(aes(x = my_date, y = unique_students)) + 
  geom_line() + 
  scale_x_date(
    breaks = scales::breaks_width(width = "2 months"), 
    labels = scales::label_date(format = "%b %Y")
  ) + 
  labs(
    title = "Respondent recruitment over time", 
    x = NULL, 
    y = "Number of unique students"
  )

```


We can also look at our recruitment of unique schools over time: 

```{r, warning=FALSE}
num_schools <- function(date) { 
  na_data %>% 
    mutate(my_date = as_date(timestamp)) %>% 
    filter(my_date <= date) %>% 
    pull(school_attend) %>% 
    n_distinct()
}


na_data %>% 
  transmute(
    my_date = as_date(timestamp), 
    unique_schools = 
      map_int(my_date, num_schools)
  ) %>% 
  ggplot(aes(x = my_date, y = unique_schools)) + 
  geom_line() + 
  scale_x_date(
    breaks = scales::breaks_width(width = "2 months"), 
    labels = scales::label_date(format = "%b %Y")
  ) + 
  labs(
    title = "School recruitment over time", 
    x = NULL, 
    y = "Number of unique schools recruited"
  )

```

Together, these plots indicate that, in general, having a survey link passively open over time does not really lead to the steady "trickling in" of responses over time. Rather, it seems that coordinated pushes of survey instruments to specific schools (with wide desemination) yield the most responses, Thus, one strategic recommendation for MSPA might be to build its survey instrument distribution infrastructure (either through a portal, an app that MSPA members can have on their phones, or some other architecture that leverages our campus network). 

## Wrangling

I've already done some data cleaning in previous scripts, but there are still a few tweaks that we probably want to make so that everything is human-readable and so that only useful information is carried forward. 

First, we want to remove people who did not consent to the survey, since we can't use their information anyway. 

```{r}
na_data <- 
  na_data %>% 
  filter(consent == "yes")
```

And then we can filter out some variables that we don't need.

```{r}
na_data <- 
  na_data %>% 
  select(-survey_id, -consent, -complete)
```

And create a few variables that we'll need later: 

```{r}
na_data <- 
  na_data %>% 
  mutate(
    sex = 
      case_when(
        sab_is_male == "yes"   ~ "male", 
        sab_is_female == "yes" ~ "female", 
        TRUE                   ~ NA_character_
      ), 
    is_urm = if_else(race_white == "yes", "no", "yes"), 
    is_gm = 
      case_when(
        gender_agender == "yes" ~ "yes", 
        gender_genderqueer == "yes" ~ "yes", 
        gender_transman == "yes" ~ "yes", 
        gender_transwoman == "yes" ~ "yes", 
        gender_another == "yes" ~ "yes", 
        TRUE ~ "no"
      )
  ) %>% 
  left_join(metadata, by = c("school_attend" = "name"))
```


## Univariate Demographics report

The first section of the survey asked questions about respondents' demographic identifiers, including the following: 

* What school they attend 
* What year of medical school they're in
* Whether or not they identify as LGBTQ+
* What sex they were assigned at birth 
* What their current gender identity is
* What they current sexual orientation is
* Their race/ethnicity

Below, we report the breakdown of our survey respondents by each of these demographics.

### What school do you attend?

Schools are arranged in order of decreasing number of responses. 

```{r}
na_data %>%
  count(school_attend, name = "Number of responses") %>% 
  mutate(
    `Percentage of total responses` = 
      ((`Number of responses` / sum(`Number of responses`)) * 100) %>% 
      round(digits = 1)
  ) %>% 
  rename(School = school_attend) %>% 
  arrange(desc(`Number of responses`)) %>% 
  knitr::kable()
```

### What year of medical school are you in? 

```{r, fig.width = 6}
n <- 
  na_data %>% 
  filter(!is.na(med_school_year)) %>% 
  count() %>% 
  pull(n)

na_data %>% 
  drop_na(med_school_year) %>% 
  mutate(
    med_school_year = fct_infreq(med_school_year %>% str_wrap(width = 25))
  ) %>% 
  ggplot(aes(x = med_school_year)) + 
  geom_bar(fill = mspa_hex) + 
  my_theme + 
  labs(
    x = NULL, 
    y = "Number of students", 
    caption = str_glue("N = ", {n})
  )
```


### Do you identify as LGBTQ+?

```{r}
n <- 
  na_data %>% 
  drop_na(is_lgbtq) %>% 
  count() %>%
  pull(n)

ns <- 
  na_data %>% 
  drop_na(is_lgbtq) %>% 
  count(is_lgbtq)

n_lgbtq <- ns$n[[1]]
n_n_lgbtq <- ns$n[[2]]

na_data %>% 
  drop_na(is_lgbtq) %>% 
  ggplot(aes(x = is_lgbtq)) + 
  geom_bar(fill = mspa_hex) + 
  labs(
    x = NULL, 
    y = "Number of respondents", 
    caption = str_glue("N = {n}")
  )
```

Or visualized slightly differently...

```{r}

na_data %>% 
  drop_na(is_lgbtq) %>% 
  count(is_lgbtq) %>% 
  ggplot(aes(fill = is_lgbtq, values = n)) + 
  geom_waffle(color = "white", n_rows = 25, size = 0.25, make_proportional = FALSE) + 
  scale_y_discrete(expand = c(0, 0)) +
  scale_x_continuous(
    labels = function(x) x * 25, 
    expand = c(0, 0)
  ) +
  scale_fill_manual(
    name = NULL, 
    labels = 
      c(
        str_glue("LGBTQ+\n({n_lgbtq})"), 
        str_glue("Non-LGBTQ+\n({n_n_lgbtq})")
      ),
    values = c(mspa_hex, "gray60")
  ) +
  coord_equal() +
  theme_minimal() + 
  theme(
    strip.text = element_text(angle = 0, hjust = 0), 
    panel.grid = element_blank(), 
    axis.ticks.x = element_line(), 
    legend.position = "bottom"
  ) + 
  labs(
    subtitle = "Do you identify as LGBTQ+?",
    x = "Number of students"
  )

```


### What is your sex assigned at birth?

```{r}
n <- 
  na_data %>% 
  filter(!is.na(sex)) %>% 
  count() %>% 
  pull(n)

na_data %>% 
  drop_na(sex) %>% 
  ggplot(aes(x = sex)) + 
  geom_bar() + 
  theme(
    axis.text = element_text(size = 12), 
    axis.title = element_text(size = 16)
  ) + 
  labs(
    x = NULL, 
    y = "Number of students", 
    caption = str_glue("N = {n}")
  )
```


Or, visualized slightly differently...
```{r}
ns <- 
  na_data %>% 
  filter(!is.na(sex)) %>% 
  count(sex)

n_male <- ns$n[[2]]
n_female <- ns$n[[1]]

ns %>% 
  ggplot(aes(fill = sex, values = n)) + 
  geom_waffle(color = "white", n_rows = 21, size = 0.25, make_proportional = FALSE) + 
  scale_y_discrete(expand = c(0, 0)) +
  scale_x_continuous(
    labels = function(x) x * 21, 
    expand = c(0, 0)
  ) +
  ggthemes::scale_fill_tableau(
    name = NULL, 
    labels = 
      c(
        str_glue("Female\n({n_female})"), 
        str_glue("Male\n({n_male})")
      ),
    palette = "Tableau 10"
  ) +
  coord_equal() +
  theme_minimal() + 
  theme(
    strip.text = element_text(angle = 0, hjust = 0), 
    panel.grid = element_blank(), 
    axis.ticks.x = element_line(), 
    legend.position = "bottom"
  ) + 
  labs(
    subtitle = "What was your sex assigned at birth?",
    x = "Number of students"
  )

```

### What is your gender identity?

```{r}
n <- 
  na_data %>% 
  filter_at(
    .vars = vars(starts_with("gender_")), 
    .vars_predicate = any_vars(!is.na(.))
  ) %>% 
  count() %>% 
  pull(n)

na_data %>% 
  summarize_at(
    .vars = vars(starts_with("gender")), 
    ~ sum(. == "yes")
  ) %>% 
  select(-gender_another_description) %>% 
  pivot_longer(
    cols = everything(), 
    names_to = "gender", 
    values_to = "Number of respondents", 
    names_prefix = "gender_"
  ) %>% 
  mutate(
    gender = fct_reorder(gender, desc(`Number of respondents`)), 
    percentage = (`Number of respondents` / sum(`Number of respondents`)) * 100
  ) %>% 
  ggplot(aes(x = gender, y = `Number of respondents`)) + 
  geom_col() + 
  geom_text(
    aes(
      y = `Number of respondents` + 15, 
      label = str_c(percentage %>% round(digits = 1), "%")
    )
  ) + 
  labs(
    x = NULL, 
    caption = str_glue("N = {n}")
  )
```

### What is your sexual orientation?

```{r}
n <- 
  na_data %>% 
  filter_at(
    .vars = vars(starts_with("so_")), 
    .vars_predicate = any_vars(!is.na(.))
  ) %>% 
  count() %>% 
  pull(n)

na_data %>% 
  summarize_at(
    .vars = vars(starts_with("so_")), 
    ~ sum(. == "yes")
  ) %>% 
  select(-so_another_description) %>% 
  pivot_longer(
    cols = everything(), 
    names_to = "sexual_orientation", 
    values_to = "Number of respondents", 
    names_prefix = "so_"
  ) %>% 
  mutate(
    sexual_orientation = fct_reorder(sexual_orientation, desc(`Number of respondents`)), 
    percentage = (`Number of respondents` / sum(`Number of respondents`)) * 100
  ) %>% 
  ggplot(aes(x = sexual_orientation, y = `Number of respondents`)) + 
  geom_col(fill = mspa_hex) + 
  geom_text(
    aes(
      y = `Number of respondents` + 15, 
      label = str_c(percentage %>% round(digits = 1), "%")
    )
  ) + 
  labs(
    x = NULL, 
    caption = str_glue("N = {n}")
  )
```

### What is your racial/ethnic background?

```{r}
n <- 
  na_data %>% 
  filter_at(
    .vars = vars(starts_with("race_")), 
    .vars_predicate = any_vars(!is.na(.))
  ) %>% 
  count() %>% 
  pull(n)

na_data %>% 
  summarize_at(
    .vars = vars(starts_with("race_")), 
    ~ sum(. == "yes")
  ) %>% 
  select(-race_another_explanation) %>% 
  pivot_longer(
    cols = everything(), 
    names_to = "race", 
    values_to = "Number of respondents", 
    names_prefix = "race_"
  ) %>% 
  mutate(
    race = fct_reorder(race, desc(`Number of respondents`)), 
    percentage = (`Number of respondents` / n) * 100
  ) %>% 
  ggplot(aes(x = race, y = `Number of respondents`)) + 
  geom_col(fill = mspa_hex) + 
  geom_text(
    aes(
      y = `Number of respondents` + 17, 
      label = str_c(percentage %>% round(digits = 1), "%")
    )
  ) + 
  scale_x_discrete(
    labels = 
      c("White", "Asian", "Hispanic", 
        "Black", "Another", "Native", 
        "Pacific Islander")
  ) + 
  labs(
    x = NULL, 
    caption = str_glue("N = {n}")
  )
```

So we can see that most of the respondents are white, a group that accounts for about 2/3 of the total responses. There are a smaller percentage of Asian, Hispanic, and Black respondents, with Native, Pacific Islander, and "Other" groups corresponding to around 1% of the responses, each. 

### Program type

With merged data about the school that each student attends, we can also compare the number of MD and the number of DO students who responded to the survey: 

```{r}
n <- 
  na_data %>% 
  filter(!is.na(Degree)) %>% 
  count() %>%
  pull(n)

na_data %>% 
  drop_na(Degree) %>% 
  count(Degree, name = "Number of respondents") %>% 
  mutate(
    Degree = fct_reorder(Degree, desc(`Number of respondents`)), 
    percentage = (`Number of respondents` / sum(`Number of respondents`)) * 100
  ) %>% 
  ggplot(aes(x = Degree, y = `Number of respondents`)) + 
  geom_col(fill = mspa_hex) + 
  geom_text(
    aes(
      y = `Number of respondents` + 20, 
      label = str_c(percentage %>% round(digits = 1), "%")
    )
  ) + 
  labs(
    title = "Number of responses from MD- and DO-granting programs", 
    x = NULL, 
    caption = str_glue("N = {n}")
  )
```

Thus, we can see that the number of DO student responses is relatively small relative to the number of MD students.

We can appreciate this sligtly better with a waffle visualization: 

```{r}
ns <- 
  na_data %>% 
  filter(!is.na(Degree)) %>% 
  count(Degree)
n_md <- ns$n[[2]]
n_do <- ns$n[[1]]

na_data %>% 
  drop_na(Degree) %>% 
  count(Degree) %>% 
  ggplot(aes(fill = Degree, values = n)) + 
  geom_waffle(color = "white", n_rows = 21, size = 0.25, make_proportional = FALSE) + 
  scale_y_discrete(expand = c(0, 0)) +
  scale_x_continuous(
    labels = function(x) x * 21, 
    expand = c(0, 0)
  ) +
  ggthemes::scale_fill_tableau(
    name = NULL, 
    labels = 
      c(
        str_glue("DO ({n_do})"), 
        str_glue("MD ({n_md})")
      ),
    palette = "Tableau 10"
  ) +
  coord_equal() +
  theme_minimal() + 
  theme(
    strip.text = element_text(angle = 0, hjust = 0), 
    panel.grid = element_blank(), 
    axis.ticks.x = element_line(), 
    legend.position = "bottom"
  ) + 
  labs(
    subtitle = "What degree does your program confer?",
    x = "Number of students"
  )
  
```


## Number of unique medical schools

According to the Association of American Medical Colleges, there are [153 accredited MD-granting programs in the United States](https://www.aamc.org/data-reports/students-residents/interactive-data/2019-facts-applicants-and-matriculants-data); likewise, the American Association of Colleges of Osteopathic Medicine (AACOM) [accredits 36 DO-granting programs](https://www.aacom.org/become-a-doctor/u-s-colleges-of-osteopathic-medicine) in the United States.

So, we can compute the number of unique MD and unique DO schools (as well as their percentage of the national numbers). 

```{r}
totals <- tibble(Degree = c("DO", "MD"), total = c(total_do, total_md))

na_data %>% 
  select(school_attend, Degree) %>%
  drop_na() %>% 
  distinct() %>%
  count(Degree) %>% 
  left_join(totals, by = "Degree") %>% 
  mutate(proportion = n / total) %>% 
  knitr::kable()

```

So, we can see that we have 100 MD schools (65% of total schools), and 18 DO schools (50% of total).

However, we remember from our response plots above that most of the schools from which we have responses only have a few (<5) students who responded...this is a problem we will either have to solve or something that we will have to wordsmith around. 

## Do medical students think MSPA is a good idea? 

In the second section of the needs-assessment survey, we asked questions about intercollegiate LGBTQ+ affinity group engagement and whether or not students felt that a national LGBTQ+ affinity organization would enhance their school's LGBTQ+ diversity/inclusion climate. 

Here's a generally useful function for plotting likert scale data that we'll use throughout this section: 

```{r}
## description: plots a stacked bar plot between LGBTQ+ and non-LGBTQ+ individuals when the likert scale is 
##              encoded by the variable my_var. Will provide the plot with the title `title` and the caption 
##              N = `n`. 
likert_plot <- function(my_var = NULL, title = NULL, n = NULL) { 
  na_data %>% 
    drop_na({{my_var}}, is_lgbtq) %>% 
    group_by(is_lgbtq, {{my_var}}) %>% 
    summarize(number = n()) %>% 
    mutate(proportion = number / sum(number)) %>% 
    ggplot(
      aes(
        x = is_lgbtq, 
        y = proportion, 
        fill = factor({{my_var}}, levels = as.character(5:1))
      )
    ) + 
    geom_hline(yintercept = 0.5, color = "black") + 
    geom_col() + 
    scale_y_continuous(labels = scales::label_percent(accuracy = 1)) + 
    scale_fill_brewer(
      labels = rev(likert_labels), 
      type = "div",
      palette = "RdYlGn", 
      aesthetics = "fill", 
      direction = -1, 
      guide = guide_legend(reverse = TRUE)
    ) + 
    coord_flip() + 
    theme(
      legend.title = element_text(size = 9),
      aspect.ratio = 0.4, 
      legend.position = "bottom"
    ) +  
    labs(
      subtitle = title,
      x = NULL,
      y = "Percentage of respondents", 
      fill = NULL,
      caption = str_glue("N = {n}")
    )
}
```


### Intercollegiate engagement of LGBTQ+ affinity organizations

**By individual - each person is a point**
```{r, fig.width=8}
#agree
n <- 
  na_data %>% 
  drop_na(interaction_agree, is_lgbtq) %>% 
  count() %>% 
  pull(n)

likert_plot(
  my_var = interaction_agree, 
  title = 
    "\"The LGBTQ+ community at my school interacts with the LGBTQ+ community at other institutions\"",
  n = n
)

#satisfied
n <- 
  na_data %>% 
  drop_na(interaction_satisfaction, is_lgbtq) %>% 
  count() %>% 
  pull(n)

likert_plot(
  my_var = interaction_satisfaction, 
  title = 
    "\"I am satisfied with the degree to which the LGBTQ+ community at my school interacts with the\nLGBTQ+ community at other institutions\"",
  n = n
)
```

In the above plots, note that we put a black reference line at 50% in order to indicate that the majority of 
LGBTQ-identifying medical students both disagree with the statement that their local LGBTQ+ affinity 
organization interacts with the larger LGBTQ+ community *and* that they are not satisfied with the level of 
intercollegiate interaction that they **do** have.

**By school - each school is a point**

If we take each unique school and average the likert scale ratings, we can make box-and-whisker plots to summarize the data in a slightly different way. 

```{r, fig.width = 8, warning = FALSE}
var_labels <- 
  setNames(
    object = , 
      c(
        "\"The LGBTQ+ community at my school interacts with the LGBTQ+ community at other institutions\"" %>% 
          str_wrap(width = 25), 
        "\"I am satisfied with the degree to which the LGBTQ+ community at my school interacts with the LGBTQ+ community at other institutions\"" %>% 
          str_wrap(width = 25)
      ), 
    nm = c("agree", "satisfaction")
  )

na_data %>% 
  drop_na(Degree, is_lgbtq) %>% 
  group_by(school_attend, is_lgbtq) %>% 
  summarize_at(
    vars(starts_with("interaction_")), 
    mean, 
    na.rm = TRUE
  ) %>% 
  pivot_longer(
    cols = starts_with("interaction_"), 
    names_to = "variable", 
    values_to = "value", 
    names_prefix = "interaction_"
  ) %>% 
  ggplot(aes(x = is_lgbtq, y = value, fill = is_lgbtq)) + 
  geom_boxplot(outlier.shape = NA) +
  geom_jitter(width = 0.2, alpha = 0.4, stroke = 0, color = "black") + 
  facet_wrap(vars(variable), labeller = labeller(variable = var_labels)) + 
  scale_y_continuous(minor_breaks = NULL) + 
  scale_fill_manual(values = c(mspa_hex, "gray60")) + 
  coord_fixed(1.4) + 
  labs(
    subtitle = "", 
    x = NULL, 
    y = "Mean likert score across all respondents (1-5)", 
    fill = NULL
  )
  
```


### Perceived benefit from a national LGBTQ+ affinity organization for medical students

**Personal Benefit**

On an individual level...

```{r, fig.width = 8}
n <- 
  na_data %>% 
  drop_na(is_lgbtq, personal_benefit_mspa) %>% 
  count() %>% 
  pull(n)

likert_plot(
  my_var = personal_benefit_mspa, 
  title = "I would personally benefit from a national LGBTQ+ affinity organization", 
  n = n
)
```

So, it's clear that the majority of LGBTQ+-identifying students feel that they would personally benefit from the existence of an organization like MSPA, with nearly 50% strongly agreeing with this statement. By contrast, most non-LGBTQ+ students didn't feel that they would necessarily benefit from such an organization personally. 

**Community benefit:**

On an individual level...

```{r, fig.width = 8}
n <- 
  na_data %>% 
  drop_na(is_lgbtq, community_benefit_mspa) %>% 
  count() %>% 
  pull(n)

likert_plot(
  my_var = community_benefit_mspa, 
  title = 
    "My community would benefit from a national LGBTQ+ affinity organization", 
  n = n
)
```


Here, we see that over 50% of all LGBTQ+ students feel that the existence of an organization such as MSPA would benefit their overall community (even if it doesn't benefit them personally), with over 80% indicating some degree of agreement. 

In addition, this plot shows us that most non-LGBTQ+ students **also** agree that the existence of an organization like MSPA would benefit the community, even if they themselves won't necessarily benefit from the org's existence personally. 

### Which of your school's activities would be enhanced by a national LGBTQ+ medical student organization?

```{r}
affinity_recode <- 
  c(
    "lgbtq_meded" = "LGBTQ+ health education",
    "social" = "LGBTQ+ social events", 
    "di_training" = "Health care provider diversity/inclusion training",
    "discrim_bias_reduction" = "Discrimination and bias reduction", 
    "mentorship" = "Physician mentorship for LGBTQ+ students",
    "advocacy" = "LGBTQ+ political/social advocacy",
    "global_health" = "LGBTQ+ Global Health",
    "research" = "Research", 
    "intercollegiate" = "Intercollegiate Engagement",
    "educational" = "Educational Activities (panels, workshops)", 
    "other" = "Other"
  )

n <- 
  na_data %>% 
 filter_at(
    .vars = vars(starts_with("enhanced_activity")), 
    .vars_predicate = any_vars(!is.na(.))
  ) %>% 
  drop_na(is_lgbtq) %>% 
  count() %>% 
  pull(n)
  

na_data %>% 
 filter_at(
    .vars = vars(starts_with("enhanced_activity")), 
    .vars_predicate = any_vars(!is.na(.))
  ) %>% 
  drop_na(is_lgbtq) %>% 
  summarize_at(
    vars(starts_with("enhanced_activity")), 
    ~ sum(. == "yes")
  ) %>% 
  select(-enhanced_activity_mspa_other_explanation) %>% 
  pivot_longer(
    cols = starts_with("enhanced_activity"), 
    names_to = "activity", 
    values_to = "Number of respondents", 
    names_prefix = "enhanced_activity_mspa_"
  ) %>% 
  mutate(
    activity = 
      fct_reorder(activity, `Number of respondents`) %>% 
      dplyr::recode(!!! affinity_recode),
    percentage = (`Number of respondents` / n) * 100
  ) %>% 
  ggplot(aes(x = activity, y = `Number of respondents`)) + 
  geom_col(fill = mspa_hex) + 
  geom_text(
    aes(
      y = `Number of respondents` + 50, 
      label = str_c(percentage %>% round(digits = 1), "%")
    )
  ) +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 30)) + 
  coord_flip() + 
  labs(
    subtitle = "Students feel that a national LGBTQ+ org will most enhance medical\neducation, advocacy, diversity & inclusion training, and LGBTQ+ mentorship", 
    x = NULL, 
    caption = str_glue("N = {n}")
  )
  
```

The plot above shows that the number 1 item that students felt would be enhanced by an organization like MSPA existing would be LGBTQ+ health education and curriculur design. 

But we can also see that 2.3% felt that "other" activities would be enhanced. What were those? 

```{r}
na_data %>% 
  select(enhanced_activity_mspa_other_explanation) %>%
  distinct() %>% 
  knitr::kable()
```

Funnily enough, no one provided any text in the free text box! Oh well. 

Of course, the data about are aggregated - the question still remains: did SGM and non-SGM feel differently about what activities would be enhanced by MSPA? 

```{r}
ns <- 
  na_data %>% 
  filter_at(
    .vars = vars(starts_with("enhanced_activity")), 
    .vars_predicate = any_vars(!is.na(.))
  ) %>% 
  drop_na(is_lgbtq) %>% 
  count(is_lgbtq)

n_lgbtq <- ns$n[[1]]
n_n_lgbtq <- ns$n[[2]]
n <- n_lgbtq + n_n_lgbtq
  
na_data %>% 
  filter_at(
    .vars = vars(starts_with("enhanced_activity")), 
    .vars_predicate = any_vars(!is.na(.))
  ) %>% 
  drop_na(is_lgbtq) %>% 
  group_by(is_lgbtq) %>% 
  summarize_at(
    vars(starts_with("enhanced_activity")), 
    ~ sum(. == "yes")
  ) %>% 
  select(-enhanced_activity_mspa_other_explanation) %>% 
  pivot_longer(
    cols = starts_with("enhanced_activity"), 
    names_to = "activity", 
    values_to = "Number of respondents", 
    names_prefix = "enhanced_activity_mspa_"
  ) %>% 
  left_join(ns, by = "is_lgbtq") %>% 
  mutate(
    activity = 
      fct_reorder2(activity, desc(is_lgbtq), desc(`Number of respondents`)) %>% 
      dplyr::recode(!!! affinity_recode),
    percentage = (`Number of respondents` / n) * 100, 
    is_lgbtq = fct_relevel(is_lgbtq, "Non-LGBTQ+", "LGBTQ+")
  ) %>% 
  ggplot(aes(x = activity, y = `Number of respondents`, fill = is_lgbtq)) + 
  geom_col(position = "dodge") + 
  geom_text(
    aes(
      y = `Number of respondents` + 35, 
      label = str_c(percentage %>% round(digits = 1), "%")
    ), 
    size = 3,
    position = position_dodge(width = 0.8)
  ) +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 30)) + 
  scale_y_continuous(limits = c(NA, 570)) + 
  scale_fill_manual(
    labels = c(
      str_glue("Non-LGBTQ+ (N = {n_n_lgbtq})"), 
      str_glue("LGBTQ+ (N = {n_lgbtq})")
    ),
    values = c("gray60", mspa_hex)
  ) + 
  coord_flip() + 
  guides(fill = guide_legend(reverse = TRUE)) + 
  labs(
    subtitle = "LGBTQ+ students feel that a national LGBTQ+ org will most enhance medical\neducation, advocacy, mentorship, and social events", 
    x = NULL, 
    fill = NULL, 
    caption = str_glue("N = {n}")
  )
  
```

These data tell a slightly different story: LGBTQ+ students still think MSPA's greatest strength will be in enhancing LGBTQ+ medical education and political/social advocacy, but they tend to think mentorship and social events will be more enhanced than non-LGBTQ+ students do. 

## Current-state assessment of local LGBTQ+ organizations 

Our needs assessment also included several questions about what students' local affinity organizations were like. The variables we measured included the following: 

* Does your school have a medical student LGBTQ+ organization of some kind? 
* If no, do you think this is something you would benefit from?
* If yes, are you involved in that organization in some way? If not, why not?
* Which of the following student group activies do you engage in?

### Does your school have a medical student LGBTQ+ affinity organization?

```{r}
n <- 
  na_data %>% 
  drop_na(Degree, school_affinity_group_exist) %>% 
  pull(school_attend) %>% 
  n_distinct()

percentage_schools <- 
  na_data %>% 
  drop_na(Degree, school_affinity_group_exist) %>% 
  group_by(school_attend) %>% 
  count(school_affinity_group_exist) %>% 
  filter(n == max(n)) %>% 
  pull(school_affinity_group_exist) %>% 
  `==`("yes") %>% 
  mean() * 
  100
```

Thus, we can see that `r str_c(percentage_schools %>% round(1), "%")` of our `r n` schools have a local affinity LGBTQ+ affinity organization. 

The schools that don't are as follows: 

```{r}
na_data %>% 
  drop_na(Degree, school_affinity_group_exist) %>% 
  group_by(school_attend) %>% 
  count(school_affinity_group_exist) %>% 
  filter(n == max(n)) %>% 
  filter(school_affinity_group_exist == "no") %>% 
  select(school_attend) %>% 
  rename(
    `Medical schools without LGBTQ+ affinity organizations` = school_attend
  ) %>% 
  knitr::kable()
```

So, for the students at these schools, do they think it'd be beneficial to have one? 

```{r, fig.width = 10}
ns <- 
  na_data %>% 
  filter(school_affinity_group_exist == "no") %>% 
  count(is_lgbtq)

n_n_lgbtq <- ns$n[[2]]
n_lgbtq <- ns$n[[1]]

na_data %>% 
  filter(school_affinity_group_exist == "no") %>% 
  group_by(is_lgbtq) %>% 
  summarize(
    number = sum(school_affinity_group_benefit == 1, na.rm = TRUE), 
    total = n(),
    prop = number / total
  ) %>% 
  ggplot(aes(x = is_lgbtq, y = prop, fill = is_lgbtq)) + 
  geom_col() + 
  scale_y_continuous(
    breaks = scales::breaks_width(width = 0.2), 
    labels = scales::label_percent(accuracy = 1)
  ) + 
  scale_fill_manual(values = c(mspa_hex, "gray60")) + 
  coord_fixed(2) + 
  theme(legend.position = "none") + 
  labs(
    subtitle = "\"Do you feel that an LGBTQ+ affinity organization is something you would benefit from?\"",
    x = NULL, 
    y = "Percentage of respondents who answered \"yes\"", 
    fill = NULL, 
    caption = 
        expression(
          paste(N["LGBTQ+"], " = ", 26, ";  ", N["non-LGBTQ+"], " = ", 33)
        )
  )

```

So, we can see that over 80% of LGBTQ+ students do feel that it's something they would benefit from, but there's not a ton of strong allyship going on (clearly). 

Shown a different way: 

```{r}
na_data %>% 
  filter(school_affinity_group_exist == "no") %>% 
  group_by(is_lgbtq) %>% 
  summarize(
    yes = sum(school_affinity_group_benefit == 1, na.rm = TRUE), 
    no = sum(school_affinity_group_benefit == 2, na.rm = TRUE),
    dont_know = sum(school_affinity_group_benefit == 3, na.rm = TRUE),
  ) %>% 
  pivot_longer(
    cols = c(yes, no, dont_know), 
    names_to = "response", 
    values_to = "count"
  ) %>% 
  ggplot(aes(fill = response, values = count)) + 
  geom_waffle(color = "white", n_rows = 3, size = 1, make_proportional = FALSE) + 
  facet_wrap(~is_lgbtq, ncol = 1) + 
  scale_y_discrete(expand = c(0, 0)) +
  scale_x_continuous(
    labels = function(x) x * 3, 
    expand = c(0, 0)
  ) +
  ggthemes::scale_fill_tableau(
    name = NULL, 
    breaks = c("yes", "no", "dont_know"), 
    labels = c("Yes", "No", "Don't know")
  ) +
  coord_equal() +
  theme_minimal() + 
  theme(
    strip.text = element_text(angle = 0, hjust = 0), 
    panel.grid = element_blank(), 
    axis.ticks.x = element_line()
  ) + 
  labs(
    subtitle = "\"Do you feel that an LGBTQ+ affinity organization is something you would benefit from?\"",
    x = "Number of students"
  )
```

Visualized this way, we can see that straight people aren't **that** problematic: they just aren't sure if they would be benefitted by their school having an LGBTQ+ affinity organization.

### Student involvement in local LGBTQ+ affinity organizations

For schools that **did** have a local LGBTQ+ affinity organization, we asked whether or students were involved. 

```{r}
ns <- 
  na_data %>% 
  drop_na(school_affinity_group_involved, is_lgbtq) %>% 
  count(school_affinity_group_involved, is_lgbtq)

n <- 
  ns %>% 
  count(wt = n) %>% 
  pull(n)

ns %>% 
  ggplot(aes(fill = school_affinity_group_involved, values = n)) + 
  geom_waffle(color = "white", n_rows = 10, size = 0.25, make_proportional = FALSE) + 
  facet_wrap(~is_lgbtq, ncol = 1) + 
  scale_y_discrete(expand = c(0, 0)) +
  scale_x_continuous(
    labels = function(x) x * 10, 
    expand = c(0, 0)
  ) +
  ggthemes::scale_fill_tableau(
    name = NULL, 
    labels = c("No", "Yes")
  ) +
  coord_equal() +
  theme_minimal() + 
  theme(
    strip.text = element_text(size = 11, angle = 0, hjust = 0), 
    panel.grid = element_blank(), 
    axis.ticks.x = element_line(), 
    legend.position = "top"
  ) + 
  labs(
    subtitle = "\"Are you involved in your local LGBTQ+ affinity organization (in some way)?\"",
    x = "Number of students", 
    caption = str_glue("Total N = {n}")
  )

```

So about 2/3 of LGBTQ-identifying medical students are involved in their LGBTQ+ medical student organization, if it exists. But 1/3 of them aren't. So, we asked why: 

```{r}
why_not_recode <- 
  c(
    "time" = "Schedule doesn't permit",
    "another" = "Another reason", 
    "uninterested" = "I'm not interested in my group's events/services",
    "opportunities" = "There aren't many opportunities to get involved", 
    "value" = "I don't see the value in joining",
    "not_queer" = "I don't identify as LGBTQ+"
  )

ns <- 
  na_data %>% 
  drop_na(is_lgbtq) %>% 
  filter(school_affinity_group_involved == "no") %>% 
  count(is_lgbtq)

n_lgbtq <- ns$n[[1]]
n_n_lgbtq <- ns$n[[2]]
n <- n_lgbtq + n_n_lgbtq

na_data %>% 
  drop_na(is_lgbtq) %>% 
  group_by(is_lgbtq) %>% 
  summarize_at(
    vars(starts_with("why_not_involved")), 
    ~ sum(. == "yes", na.rm = TRUE)
  ) %>% 
  select(-why_not_involved_another_explanation) %>% 
  pivot_longer(
    cols = starts_with("why_not_involved"), 
    names_to = "reason", 
    values_to = "value", 
    names_prefix = "why_not_involved_"
  ) %>% 
  group_by(is_lgbtq) %>% 
  mutate(
    prop = value / sum(value), 
    reason = 
      reason %>% 
      recode(!!! why_not_recode) %>% 
      fct_reorder(prop)
  ) %>% 
  ggplot(aes(x = reason, y = prop, fill = fct_rev(is_lgbtq))) + 
  geom_col(position = "dodge") + 
  geom_text(
    aes(y = prop + 0.005, label = (prop * 100) %>% round(1) %>% str_c("%")), 
    position = position_dodge(width = 0.85), 
    hjust = 0
  ) + 
  scale_x_discrete(labels = function(x) str_wrap(x, width = 30)) + 
  scale_y_continuous(
    limits = c(NA, 0.44), 
    labels = scales::label_percent(accuracy = 1)
  ) + 
  scale_fill_manual(
    values = c("gray60", mspa_hex), 
    labels = 
      c(
        str_glue("Non-LGBTQ (N = {n_n_lgbtq})"), 
        str_glue("LGBTQ+ (N = {n_lgbtq})") 

      )
  ) + 
  coord_flip() + 
  guides(fill = guide_legend(reverse = TRUE)) + 
  labs(
    subtitle = "\"Why aren't you involved in your local LGBTQ+ organization?\"", 
    x = NULL, 
    y = "Percentage of respondents",
    fill = NULL,
    caption = str_glue("N = {n}")
  )
```

From this plot, we can see that the main reason students don't engage in organized LGBTQ+ programming at their medical schools locally is that they don't have time. Other reasons include that they aren't sure how to get involved or their interests aren't reflected in the group's current activities. 

Another useful insight from this plot is that the reason that most non-LGBTQ+ students don't participate in LGBTQ+ programming at their medical school is that they don't identify within the community. So, it's clear that there's still a prevailing assumption that affinity group programming might not be appealing (or have a space for) allyship among most straight and cisgender people. 

Interestingly, `Another reason` was the second most-common reason that LGBTQ+ medical students choose not to be a part of their local LGBTQ+ organization. What are some of those reasons?

```{r}
na_data %>% 
  filter(is_lgbtq == "LGBTQ+") %>%
  drop_na(why_not_involved_another_explanation) %>% 
  select(`Reason I'm not involved with my local LGBTQ+ organizatation:` = 
           why_not_involved_another_explanation) %>% 
  knitr::kable()
```


There are several interesting threads or themes that seem to emerge in these responses, including the following: 

* The first response is very intense! 
* Outness in professional contexts seems to be a barrier to involvement
* Trans students and students of color may not identify with institutional affinity organizations because of the predominance of cisgender and white stakeholders who predominate the groups. 

### What does your local affinity organization do?

```{r}
ns <- 
  na_data %>% 
  filter_at(
    .vars = vars(starts_with("school_activities")), 
    .vars_predicate = any_vars(!is.na(.))
  ) %>% 
  drop_na(is_lgbtq) %>% 
  count(is_lgbtq)

n_lgbtq <- ns$n[[1]]
n_n_lgbtq <- ns$n[[2]]
n <- n_lgbtq + n_n_lgbtq

na_data %>% 
  filter_at(
    .vars = vars(starts_with("school_activities")), 
    .vars_predicate = any_vars(!is.na(.))
  ) %>% 
  drop_na(is_lgbtq) %>% 
  group_by(is_lgbtq) %>% 
  summarize_at(
    vars(starts_with("school_activities")), 
    ~ sum(. == "yes")
  ) %>% 
  select(-school_activities_other_explanation) %>% 
  pivot_longer(
    cols = starts_with("school_activities"), 
    names_to = "activity", 
    values_to = "Number of respondents", 
    names_prefix = "school_activities_"
  ) %>% 
  left_join(ns, by = "is_lgbtq") %>% 
  mutate(
    activity = 
      fct_reorder2(activity, desc(is_lgbtq), desc(`Number of respondents`)) %>% 
      dplyr::recode(!!! affinity_recode),
    percentage = (`Number of respondents` / n) * 100, 
    is_lgbtq = fct_relevel(is_lgbtq, "Non-LGBTQ+", "LGBTQ+")
  ) %>% 
  ggplot(aes(x = activity, y = `Number of respondents`, fill = is_lgbtq)) + 
  geom_col(position = "dodge") + 
  geom_text(
    aes(
      y = `Number of respondents` + 2, 
      label = str_c(percentage %>% round(digits = 1), "%")
    ), 
    size = 3.5,
    position = position_dodge(width = 0.85), 
    hjust = 0
  ) +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 25)) + 
  scale_y_continuous(limits = c(NA, 430)) + 
  scale_fill_manual(
    labels = 
      c(
        str_glue("Non-LGBTQ+ (N = {n_n_lgbtq})"), 
        str_glue("LGBTQ+ (N = {n_lgbtq})")
        ),
    values = c("gray60", mspa_hex)) + 
  coord_flip() + 
  guides(fill = guide_legend(reverse = TRUE)) + 
  labs(
    subtitle = "\"In which of the following student group activities do you engage?\"", 
    x = NULL, 
    fill = NULL, 
    caption = str_glue("N = {n}")
  )
```

So we can see that LGBTQ+ student groups tend to focus on social events and educational programming more than other activities. Some participate directly in advocacy work, and relatively few have mentorship programs, intercollegiate engagement programs, or research teams. 

### LGBTQ+ student group assessment: mission, member support, and member identification

We asked students a few big-picture questions about their school's LGBTQ+ affinity organization, including the following: 

* Do you feel that your school's org has a strong mission? 
* Do you feel supported by your school's org? 
* Do you identify with the other members of your school's org?

Here are the results to those questions: 

**student-by-student**

```{r, fig.width = 8, message = FALSE, warning = FALSE}
my_vars <- 
  c(
    "school_affinity_group_mission", 
    "school_affinity_group_supported", 
    "school_affinity_group_identify"
  )

n <- 
  na_data %>% 
  select(one_of(my_vars, "is_lgbtq")) %>% 
  drop_na() %>% 
  count()

variable_recode <- 
  c(
    "identify" = 
      "I easily identify with members of my school's LGBTQ+ student group.", 
    "mission" = 
      "I feel that the LGBTQ+ medical student group at my school has a clear mission.", 
    "supported" = 
      "I feel supported by the LGBTQ+ medical student group at my medical school."
    )

na_data %>% 
  group_by(
    is_lgbtq = factor(is_lgbtq, levels = c("Non-LGBTQ+", "LGBTQ+"))
    ) %>% 
  select(one_of(my_vars)) %>% 
  pivot_longer(
    cols = -is_lgbtq, 
    names_to = "variable", 
    values_to = "ratings", 
    names_prefix = "school_affinity_group_"
  ) %>% 
  drop_na() %>% 
  mutate(
    ratings = 
      recode(ratings, !!! likert_labels) %>% 
      factor(levels = rev(likert_labels)), 
    variable = recode(variable, !!! variable_recode) 
  ) %>% 
  count(is_lgbtq, variable, ratings) %>% 
  group_by(is_lgbtq, variable) %>% 
  mutate(proportion = n / sum(n)) %>% 
  ggplot(
    aes(x = is_lgbtq, y = proportion, fill = ratings)
  ) + 
  geom_hline(yintercept = 0.5, color = "black") + 
  geom_col() + 
  facet_wrap(vars(variable), ncol = 1) + 
  scale_y_continuous(labels = scales::label_percent(accuracy = 1)) + #coord_flip()
  scale_fill_brewer(
    #have to check that this is right
    labels = rev(likert_labels), 
    type = "div",
    palette = "RdYlGn", 
    aesthetics = "fill", 
    direction = -1, 
    guide = guide_legend(reverse = TRUE)
  ) + 
  coord_flip() + 
  theme(
    legend.title = element_text(size = 9),
    legend.position = "bottom"
  ) +  
  labs(
    subtitle = "",
    x = NULL,
    y = "Percentage of respondents", 
    fill = NULL,
    caption = str_glue("N = {n}")
  )
```

Lets interpret the plot above panel by panel: 

* In general, it looks like most LGBTQ+ students and non-LGBTQ+ students alike identify with members of their institutional affinity organizations, although slightly more LGBTQ+ students identify with the members of the group than non-LGBTQ+ students. 

* Most LGBTQ+ students feel supported (in some way) by their LGBTQ+ affinity organization, but most non-LGBTQ+ students neither agree nor disagree with the statement. 

* A majority of both LGBTQ+ students and non-LGBTQ+ students felt that their local affinity organizations had a clear mission, but Non-LGBTQ+ students seemed to think that groups' missions were clearer overall than their LGBTQ+ counterparts. 

Note that these plots weight every student equally regardless of where they go to school or how they identify. We can aggregate students who go to the same school to give school-level summaries of the data (which is less prone to tyranny of the majority). 

**School-level summaries**

```{r, warning = FALSE, message = FALSE}
variable_recode <- 
  setNames(
    object = , 
      c(
        "\"I easily identify with members of my school's LGBTQ+ student group.\"" %>% 
          str_wrap(width = 35), 
        "\"I feel that the LGBTQ+ medical student group at my school has a clear mission.\"" %>% 
          str_wrap(width = 35), 
        "\"I feel supported by the LGBTQ+ medical student group at my medical school.\"" %>% 
          str_wrap(width = 35)
      ), 
    nm = c("identify", "mission", "supported")
  )

na_data %>% 
  group_by(
    is_lgbtq = factor(is_lgbtq, levels = c("LGBTQ+", "Non-LGBTQ+")), 
    school_attend
  ) %>% 
  select(one_of(my_vars)) %>% 
  pivot_longer(
    cols = c(-is_lgbtq, -school_attend),
    names_to = "variable", 
    values_to = "ratings", 
    names_prefix = "school_affinity_group_"
  ) %>% 
  drop_na() %>% 
  mutate(variable = recode(variable, !!! variable_recode)) %>% 
  group_by(is_lgbtq, school_attend, variable) %>% 
  summarize(ratings = mean(ratings)) %>% 
  ggplot(aes(x = is_lgbtq, y = ratings, fill = is_lgbtq)) + 
  geom_boxplot(outlier.shape = NA) +
  geom_jitter(width = 0.2, alpha = 0.4, stroke = 0, color = "black") + 
  facet_wrap(vars(variable)) + 
  scale_y_continuous(minor_breaks = NULL) + 
  scale_fill_manual(values = c(mspa_hex, "gray60")) + 
  theme(
    legend.position = "none"
  ) + 
  labs(
    x = NULL, 
    y = "Average likert rating per school (1-5 scale)", 
    caption = str_glue("N = {n}")
  )

```

And we see that, even when calculating school-level (as opposed to individual-level) responses, we see the same trends as above. This indicates that the effects we've noticed aren't being driven solely by the schools with the largest number of respondents. 

Another thing that I was interested in (related to some of the discussion above) was whether or not all demographic groups felt the same way about how they related to their local LGBTQ+ affinity organization. We can look into that a bit here: 

```{r, fig.width = 8, warning = FALSE, message = FALSE}
variable_recode <- 
  c(
    "identify" = 
      "I easily identify with members of my school's LGBTQ+ student group.", 
    "mission" = 
      "I feel that the LGBTQ+ medical student group at my school has a clear mission.", 
    "supported" = 
      "I feel supported by the LGBTQ+ medical student group at my medical school."
    )

na_data %>% 
  filter(is_lgbtq == "LGBTQ+") %>% 
  mutate(
    status = 
      case_when(
        is_urm == "yes" & is_gm == "yes" ~ "POC/GM", 
        is_urm == "yes" & is_gm == "no" ~ "POC", 
        is_urm == "no" & is_gm == "yes" ~ "GM", 
        TRUE ~ "Non-POC/Non-GM"
      ) %>% 
      factor(levels = c("Non-POC/Non-GM", "URM", "GM", "POC/GM"))
  ) %>% 
  group_by(status) %>% 
  select(one_of(my_vars)) %>% 
  pivot_longer(
    cols = -status, 
    names_to = "variable", 
    values_to = "ratings", 
    names_prefix = "school_affinity_group_"
  ) %>% 
  drop_na() %>% 
  mutate(
    ratings = 
      recode(ratings, !!! likert_labels) %>% 
      factor(levels = rev(likert_labels)), 
    variable = recode(variable, !!! variable_recode) 
  ) %>% 
  count(status, variable, ratings) %>% 
  group_by(status, variable) %>% 
  mutate(proportion = n / sum(n)) %>% 
  ggplot(
    aes(x = status, y = proportion, fill = ratings)
  ) + 
  geom_hline(yintercept = 0.5, color = "black") + 
  geom_col() + 
  facet_wrap(vars(variable), ncol = 1) + 
  scale_y_continuous(labels = scales::label_percent(accuracy = 1)) + #coord_flip()
  scale_fill_brewer(
    #have to check that this is right
    labels = rev(likert_labels), 
    type = "div",
    palette = "RdYlGn", 
    aesthetics = "fill", 
    direction = -1, 
    guide = guide_legend(reverse = TRUE)
  ) + 
  coord_flip() + 
  theme(
    legend.title = element_text(size = 9),
    legend.position = "bottom"
  ) +  
  labs(
    subtitle = "",
    x = NULL,
    y = "Percentage of respondents", 
    fill = NULL,
    caption = str_glue("N = {n}")
  )
```

From these plots, we can see that students who identified as underrepresented in medicine (non-white) and as gender minorities (all categories except cisgender men and cisgender women) tend to identify with other members of their LGBTQ+ organization less and tend to feel that the groups do not have as clear of a mission. 

## What are LGBTQ+ medical students interested in?

In this section of the NA, we asked the following:

>In the following questions, we ask that you rank the degree to which, in general, you are interested in each topic on a scale from 5 (very interested) to 1 (not at all interested). This information could be used to develop areas of focus for a national LGBTQ+ medical student organization.

The results are as follows: 

**Student-by-student:**

```{r, fig.width = 11, message = FALSE, warning = FALSE}

interest_recode <- 
  c(
    "meded" = "LGBTQ+ health education",
    "social" = "LGBTQ+ social events", 
    "bias_training" = "Implicit bias and LGBTQ+ anti-discrimination training", 
    "mentorship" = "Physician mentorship for LGBTQ+ students",
    "advocacy" = "LGBTQ+ political/social advocacy",
    "global_health" = "LGBTQ+ Global Health",
    "other" = "Other"
  )

n <- 
  na_data %>% 
  group_by(is_lgbtq) %>% 
  select(starts_with("interest_"), -interest_lgbtq_other) %>%
  drop_na() %>% 
  count()

n_lgbtq <- n$n[[1]]
n_n_lgbtq <- n$n[[2]]

n_total <- n_lgbtq + n_n_lgbtq

variable_recode <- 
  c(
    "identify" = 
      "I easily identify with members of my school's LGBTQ+ student group.", 
    "mission" = 
      "I feel that the LGBTQ+ medical student group at my school has a clear mission.", 
    "supported" = 
      "I feel supported by the LGBTQ+ medical student group at my medical school."
    )

na_data %>% 
  group_by(is_lgbtq) %>% 
  select(starts_with("interest_"), -interest_lgbtq_other) %>%
  pivot_longer(
    cols = -is_lgbtq, 
    names_to = "variable", 
    values_to = "ratings", 
    names_prefix = "interest_lgbtq_"
  ) %>% 
  drop_na() %>% 
  mutate(
    ratings = 
      recode(ratings, !!! interest_labels) %>% 
      factor(levels = rev(interest_labels)), 
    variable = recode(variable, !!! interest_recode)
  ) %>% 
  count(is_lgbtq, variable, ratings) %>% 
  group_by(is_lgbtq, variable) %>% 
  mutate(proportion = n / sum(n)) %>% 
  ungroup() %>% 
  mutate(variable = fct_reorder(variable, proportion, max)) %>% 
  ggplot(
    aes(x = variable, y = proportion, fill = ratings)
  ) + 
  geom_hline(yintercept = 0.5, color = "black") + 
  geom_col() + 
  facet_wrap(vars(is_lgbtq), ncol = 1) + 
  scale_y_continuous(labels = scales::label_percent(accuracy = 1)) + #coord_flip()
  scale_fill_brewer(
    #have to check that this is right
    labels = rev(interest_labels), 
    type = "div",
    palette = "RdYlGn", 
    aesthetics = "fill", 
    direction = -1, 
    guide = guide_legend(reverse = TRUE)
  ) + 
  coord_flip() + 
  theme(
    legend.title = element_text(size = 9),
    legend.position = "bottom"
  ) +  
  labs(
    subtitle = "LGBTQ+ medical students are most interested in LGBTQ+ health education",
    x = NULL,
    y = "Percentage of respondents", 
    fill = NULL,
    caption = str_glue("N = {n_total}")
  )  
```


From this plot, we can see that LGBTQ+ medical students seem to be the most interested overall in LGBTQ+ health education, followed by social/political advocacy, then implicit bias/anti-discrimination training. Interestingly, we can also see that Non-LGBTQ+ studenta are most interested in implicit bias/LGBTQ+ anti-discrimination training (in this case, it would likely be something like "allyship training") and are not very interested in social events (cough cough). 


We also asked students to indicate which of the above categories were "important (however you define importance) in your **professional** development as a future physician" and to give the degree of satisfaction that they felt at their medical school for each topic on a scale from 1-10. 


Importance: 

```{r}

```

Satisfaction: 

```{r}

```


## Outness - how "out" are LGBTQ-identifying medical students in various contexts?

```{r, fig.width = 8, fig.height = 7}
context_recode <- 
  c(
    "classmates_peers" = "To peers", 
    "labmates_coworkers_team" = "To labmates or team members", 
    "mentors" = "To mentors", 
    "medical_school_app" = "On application to medical school", 
    "residency_app" = "On application to residency/post-doctoral studies"
  )

n <- 
  na_data %>% 
  select(
    starts_with("out_"), 
    starts_with("ability_out_"), 
    starts_with("protections_out"), 
    sex, 
    is_urm, 
    is_gm, 
    school_attend, 
    is_lgbtq
  ) %>% 
  select(-contains("explanation")) %>% 
  drop_na(school_attend, is_lgbtq) %>% 
  nrow()
  
  
  
outness_data <- 
  na_data %>% 
  select(
    starts_with("out_"), 
    starts_with("ability_out_"), 
    starts_with("protections_out"), 
    sex, 
    is_urm, 
    is_gm, 
    school_attend, 
    is_lgbtq
  ) %>% 
  select(
    -contains("explanation"), 
    -contains("other")
  ) %>% 
  drop_na(school_attend, is_lgbtq) %>% 
  pivot_longer(
    cols = 
      c(
        starts_with("out_"), 
        starts_with("ability_out_"), 
        starts_with("protections_out")
      ), 
    names_to = c("variable", "context"), 
    values_to = "is_out", 
    names_sep = "ut_"
  ) %>% 
  mutate(
    variable = 
      recode(
        variable, 
        "o" = "Out (or plan to be out)", 
        "ability_o" = "Support ability to be out", 
        "protections_o" = "Support protections for outness"
      ), 
    context = 
      recode(
        context, 
        !!! context_recode
      ) 
  )

outness_data %>% 
  group_by(is_lgbtq, variable, context) %>% 
  summarize(prop = sum(is_out == "yes") / n()) %>% 
  mutate(context = fct_reorder(context, desc(prop))) %>% 
  ggplot(aes(x = context, y = prop, fill = is_lgbtq)) + 
  geom_col(position = "dodge", color = "black") +
  geom_text(
    aes(label = (prop * 100) %>% round(0)), 
    vjust = -0.2, 
    size = 4, 
    position = position_dodge(width = 0.9), 
    fontface = "bold"
  ) + 
  facet_wrap(vars(variable), ncol = 3) + 
  scale_y_continuous(labels = scales::label_percent(accuracy = 1)) + 
  scale_fill_manual(
    breaks = c("LGBTQ+", "Non-LGBTQ+"), 
    values = c(mspa_hex, "gray60") 
  ) + 
  theme(
    legend.position = "bottom", 
    axis.text.x = element_text(size = 10, angle = 45, hjust = 1),
    ) + 
  labs(
    x = NULL, 
    y = "% of Students", 
    fill = NULL, 
    caption = str_glue("N = {n}")
  )
  
```




## How can MSPA promote intersectionality in its activities? 

We asked students for free-text responses to the following question: 

>The LGBTQ community represents a wide array of identities and viewpoints, particularly with regard to issues of intersectionality. In what ways would an intercollegiate medical student organization best represent all of these viewpoints in an equitable way, especially regarding queer and trans people of color?

and `r sum(!is.na(na_data$intersectionality))` of them responded. Here are the responses: 

```{r}
na_data %>% 
  drop_na(intersectionality) %>% 
  select(Intersectionality = intersectionality) %>% 
  knitr::kable()
```

